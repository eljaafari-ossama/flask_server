from flask import Flask, jsonify, request
import sqlite3

app = Flask(__name__)

# Fonction pour se connecter à la base de données SQLite
def get_connection():
    conn = sqlite3.connect('C:/Users/HP/Documents/stage/REPORT_DATA1.db')
    return conn

# Route pour obtenir les dernières données
@app.route('/latest', methods=['GET'])
def get_latest_data():
    conn = get_connection()
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM report_table ORDER BY date_temps DESC LIMIT 1")
    row = cursor.fetchone()
    conn.close()
    if row:
        return jsonify({
            'date_temps': row[0],
            'Pressure': row[1],
            'GasLevel': row[2],
            'Alarm1': row[3],
            'Alarm2': row[4],
            'LeakDetected': row[5],
            'arret_urgence': row[6]
        })
    else:
        return jsonify({'error': 'No data found'}), 404

# Route pour obtenir des données par date
@app.route('/data', methods=['GET'])
def get_data_by_date():
    start_date = request.args.get('start_date')
    end_date = request.args.get('end_date')
    conn = get_connection()
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM report_table WHERE date_temps BETWEEN ? AND ?", (start_date, end_date))
    rows = cursor.fetchall()
    conn.close()
    data = []
    for row in rows:
        data.append({
            'date_temps': row[0],
            'Pressure': row[1],
            'GasLevel': row[2],
            'Alarm1': row[3],
            'Alarm2': row[4],
            'LeakDetected': row[5],
            'arret_urgence': row[6]
        })
    return jsonify(data)

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
